{"ast":null,"code":"import { Stomp } from '@stomp/stompjs';\nimport SockJS from 'sockjs-client';\nconst SOCKET_URL = 'http://localhost:8080/ws';\nlet stompClient = null;\nconst connectWebSocket = (userId, onMessageReceived) => {\n  const socket = new SockJS(SOCKET_URL);\n  stompClient = Stomp.over(socket);\n  stompClient.connect({}, () => {\n    console.log('Connected to WebSocket');\n\n    // Subscribe to user-specific queue for tasks\n    stompClient.subscribe(`/user/${userId}/queue/tasks`, message => {\n      console.log(\"Received message on /user/\" + userId + \"/queue/tasks:\", message);\n      handleWebSocketMessage(message, onMessageReceived);\n    });\n    stompClient.subscribe('/topic/tasks', message => {\n      console.log(\"Received message on /topic/tasks:\", message);\n      handleWebSocketMessage(message, onMessageReceived);\n    });\n  }, error => {\n    console.error('Error connecting to WebSocket:', error);\n    setTimeout(() => connectWebSocket(userId, onMessageReceived), 5000);\n  });\n};\nconst handleWebSocketMessage = (message, onMessageReceived) => {\n  if (message.body) {\n    try {\n      const parsedMessage = JSON.parse(message.body);\n      onMessageReceived(parsedMessage);\n    } catch (error) {\n      console.error('Failed to parse WebSocket message:', error);\n    }\n  } else {\n    console.error('Message body is missing or undefined');\n  }\n};\nconst disconnectWebSocket = () => {\n  if (stompClient) {\n    stompClient.disconnect(() => {\n      console.log('Disconnected from WebSocket');\n    });\n  }\n};\nconst sendWebSocketMessage = (destination, message) => {\n  if (stompClient && stompClient.connected) {\n    const token = localStorage.getItem('jwtToken');\n    const headers = token ? {\n      Authorization: `Bearer ${token}`\n    } : {};\n    console.log('Sending message to', destination);\n    try {\n      stompClient.send(destination, headers, JSON.stringify(message));\n    } catch (error) {\n      console.error('Failed to send WebSocket message:', error);\n    }\n  } else {\n    console.error('WebSocket is not connected');\n  }\n};\nconst sendUpdateTaskMessage = (taskId, taskSaveDTO) => {\n  if (typeof taskId !== 'number') {\n    console.error('taskId is not a number:', taskId);\n    return;\n  }\n  console.log('Sending update task message with taskId:', taskId);\n  sendWebSocketMessage(`/app/updateTask/${taskId}`, taskSaveDTO);\n};\nexport { connectWebSocket, disconnectWebSocket, sendWebSocketMessage, sendUpdateTaskMessage };","map":{"version":3,"names":["Stomp","SockJS","SOCKET_URL","stompClient","connectWebSocket","userId","onMessageReceived","socket","over","connect","console","log","subscribe","message","handleWebSocketMessage","error","setTimeout","body","parsedMessage","JSON","parse","disconnectWebSocket","disconnect","sendWebSocketMessage","destination","connected","token","localStorage","getItem","headers","Authorization","send","stringify","sendUpdateTaskMessage","taskId","taskSaveDTO"],"sources":["/Users/finngarrels/IdeaProjects/Tick2GetherProject/tick2gether_frontend/src/websocket.js"],"sourcesContent":["import { Stomp } from '@stomp/stompjs';\nimport SockJS from 'sockjs-client';\n\nconst SOCKET_URL = 'http://localhost:8080/ws';\n\nlet stompClient = null;\n\nconst connectWebSocket = (userId, onMessageReceived) => {\n  const socket = new SockJS(SOCKET_URL);\n  stompClient = Stomp.over(socket);\n\n  stompClient.connect({}, () => {\n    console.log('Connected to WebSocket');\n\n    // Subscribe to user-specific queue for tasks\n    stompClient.subscribe(`/user/${userId}/queue/tasks`, (message) => {\n      console.log(\"Received message on /user/\" + userId + \"/queue/tasks:\", message);\n      handleWebSocketMessage(message, onMessageReceived);\n    });\n    stompClient.subscribe('/topic/tasks', (message) => {\n      console.log(\"Received message on /topic/tasks:\", message);\n      handleWebSocketMessage(message, onMessageReceived);\n    });\n\n  }, (error) => {\n    console.error('Error connecting to WebSocket:', error);\n    setTimeout(() => connectWebSocket(userId, onMessageReceived), 5000);\n  });\n};\n\nconst handleWebSocketMessage = (message, onMessageReceived) => {\n  if (message.body) {\n    try {\n      const parsedMessage = JSON.parse(message.body);\n      onMessageReceived(parsedMessage);\n    } catch (error) {\n      console.error('Failed to parse WebSocket message:', error);\n    }\n  } else {\n    console.error('Message body is missing or undefined');\n  }\n};\n\nconst disconnectWebSocket = () => {\n  if (stompClient) {\n    stompClient.disconnect(() => {\n      console.log('Disconnected from WebSocket');\n    });\n  }\n};\n\nconst sendWebSocketMessage = (destination, message) => {\n  if (stompClient && stompClient.connected) {\n    const token = localStorage.getItem('jwtToken');\n    const headers = token ? { Authorization: `Bearer ${token}` } : {};\n    console.log('Sending message to', destination);\n    try {\n      stompClient.send(destination, headers, JSON.stringify(message));\n    } catch (error) {\n      console.error('Failed to send WebSocket message:', error);\n    }\n  } else {\n    console.error('WebSocket is not connected');\n  }\n};\n\nconst sendUpdateTaskMessage = (taskId, taskSaveDTO) => {\n  if (typeof taskId !== 'number') {\n    console.error('taskId is not a number:', taskId);\n    return;\n  }\n  console.log('Sending update task message with taskId:', taskId);\n  sendWebSocketMessage(`/app/updateTask/${taskId}`, taskSaveDTO);\n};\n\nexport { connectWebSocket, disconnectWebSocket, sendWebSocketMessage, sendUpdateTaskMessage };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}